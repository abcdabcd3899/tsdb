\set tname test_mars_mergescan_plain
 \set tagtype int
 \set with
 \i sql/mergescan.load.template
-- start_ignore
drop table if exists :tname;
-- end_ignore
create table :tname
     ( tag :tagtype
     , ts timestamp
     , c1 int
     , c2 float
     , c3 text
     )
 using mars
 :with
 distributed masteronly;
-- insert the initial data, no overlaps
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(40, 55) i;
-- rows in the same block are merged during INSERT
\i sql/mergescan.queries.template
select ctid, * from :tname;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

select ctid, * from :tname order by tag, ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by tag desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
(16 rows)

select ctid, * from :tname order by tag desc, ts desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
(16 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
(16 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
(16 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
(4 rows)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
(4 rows)

select ctid, * from :tname where c1 >= 400;
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |    | text 42
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |    | text 46
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |    | text 50
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |    | text 54
(8 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
(2 rows)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
  ctid  | c1  | c2  |   c3    
--------+-----+-----+---------
 (1,1)  | 400 |     | text 40
 (1,2)  |     | 4.1 | text 41
 (1,3)  | 420 |     | text 42
 (1,4)  |     | 4.3 | text 43
 (1,5)  | 440 |     | text 44
 (1,6)  |     | 4.5 | text 45
 (1,7)  | 460 |     | text 46
 (1,8)  |     | 4.7 | text 47
 (1,9)  | 480 |     | text 48
 (1,10) |     | 4.9 | text 49
 (1,11) | 500 |     | text 50
 (1,12) |     | 5.1 | text 51
 (1,13) | 520 |     | text 52
 (1,14) |     | 5.3 | text 53
 (1,15) | 540 |     | text 54
 (1,16) |     | 5.5 | text 55
(16 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     2
  11 |     2
  12 |     2
  13 |     2
(4 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     2
  11 |     2
  12 |     2
  13 |     2
(4 rows)

-- vi: syntax=sql et :
-- insert the late data, no overlaps
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(32, 39) i;
-- blocks are not merged
\i sql/mergescan.queries.template
select ctid, * from :tname;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
(24 rows)

-- order 0
select ctid, * from :tname order by tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
(24 rows)

select ctid, * from :tname order by tag, ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

-- order 0
select ctid, * from :tname order by tag desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
(24 rows)

select ctid, * from :tname order by tag desc, ts desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
(24 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
(24 rows)

-- order 0
select ctid, * from :tname order by ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
(24 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
(24 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
(4 rows)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |    | text 32
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |    | text 36
(6 rows)

select ctid, * from :tname where c1 >= 400;
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |    | text 42
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |    | text 46
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |    | text 50
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |    | text 54
(8 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
(2 rows)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
  ctid  | c1  | c2  |   c3    
--------+-----+-----+---------
 (1,1)  | 400 |     | text 40
 (1,2)  |     | 4.1 | text 41
 (1,3)  | 420 |     | text 42
 (1,4)  |     | 4.3 | text 43
 (1,5)  | 440 |     | text 44
 (1,6)  |     | 4.5 | text 45
 (1,7)  | 460 |     | text 46
 (1,8)  |     | 4.7 | text 47
 (1,9)  | 480 |     | text 48
 (1,10) |     | 4.9 | text 49
 (1,11) | 500 |     | text 50
 (1,12) |     | 5.1 | text 51
 (1,13) | 520 |     | text 52
 (1,14) |     | 5.3 | text 53
 (1,15) | 540 |     | text 54
 (1,16) |     | 5.5 | text 55
 (2,1)  | 320 |     | text 32
 (2,2)  |     | 3.3 | text 33
 (2,3)  | 340 |     | text 34
 (2,4)  |     | 3.5 | text 35
 (2,5)  | 360 |     | text 36
 (2,6)  |     | 3.7 | text 37
 (2,7)  | 380 |     | text 38
 (2,8)  |     | 3.9 | text 39
(24 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     2
  11 |     2
  12 |     2
  13 |     2
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     2
  11 |     2
  12 |     2
  13 |     2
(6 rows)

-- vi: syntax=sql et :
-- insert the late data, the blocks overlap, the rows do not
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10 + 40)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(40, 55) i;
-- blocks are merged on the group keys
\i sql/mergescan.queries.template
select ctid, * from :tname;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
(40 rows)

select ctid, * from :tname order by tag, ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by tag desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
(40 rows)

select ctid, * from :tname order by tag desc, ts desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
(40 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
(40 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
(40 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(40 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,3) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,4) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (3,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (3,3) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (3,4) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
(8 rows)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |    | text 32
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 | 360 |    | text 36
(6 rows)

select ctid, * from :tname where c1 >= 400;
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |    | text 42
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |    | text 46
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 | 500 |    | text 50
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 | 540 |    | text 54
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 | 400 |    | text 40
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 | 420 |    | text 42
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 | 440 |    | text 44
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 | 460 |    | text 46
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 | 480 |    | text 48
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 | 500 |    | text 50
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 | 520 |    | text 52
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 | 540 |    | text 54
(16 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
(2 rows)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
  ctid  | c1  | c2  |   c3    
--------+-----+-----+---------
 (1,1)  | 400 |     | text 40
 (1,2)  |     | 4.1 | text 41
 (1,3)  | 420 |     | text 42
 (1,4)  |     | 4.3 | text 43
 (1,5)  | 440 |     | text 44
 (1,6)  |     | 4.5 | text 45
 (1,7)  | 460 |     | text 46
 (1,8)  |     | 4.7 | text 47
 (1,9)  | 480 |     | text 48
 (1,10) |     | 4.9 | text 49
 (1,11) | 500 |     | text 50
 (1,12) |     | 5.1 | text 51
 (1,13) | 520 |     | text 52
 (1,14) |     | 5.3 | text 53
 (1,15) | 540 |     | text 54
 (1,16) |     | 5.5 | text 55
 (2,1)  | 320 |     | text 32
 (2,2)  |     | 3.3 | text 33
 (2,3)  | 340 |     | text 34
 (2,4)  |     | 3.5 | text 35
 (2,5)  | 360 |     | text 36
 (2,6)  |     | 3.7 | text 37
 (2,7)  | 380 |     | text 38
 (2,8)  |     | 3.9 | text 39
 (3,1)  | 400 |     | text 40
 (3,2)  |     | 4.1 | text 41
 (3,3)  | 420 |     | text 42
 (3,4)  |     | 4.3 | text 43
 (3,5)  | 440 |     | text 44
 (3,6)  |     | 4.5 | text 45
 (3,7)  | 460 |     | text 46
 (3,8)  |     | 4.7 | text 47
 (3,9)  | 480 |     | text 48
 (3,10) |     | 4.9 | text 49
 (3,11) | 500 |     | text 50
 (3,12) |     | 5.1 | text 51
 (3,13) | 520 |     | text 52
 (3,14) |     | 5.3 | text 53
 (3,15) | 540 |     | text 54
 (3,16) |     | 5.5 | text 55
(40 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

-- vi: syntax=sql et :
-- insert the late data, both the blocks and rows overlap
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 8 < 4 then 1000 + i * 10 else null end
     , case when i % 8 > 3 then 1000 + i / 10. else null end
     , 'text ' || (1000 + i)
  from generate_series(40, 47) i;
-- blocks and orws are merged on the group keys
\i sql/mergescan.queries.template
select ctid, * from :tname;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
(48 rows)

-- order 0
select ctid, * from :tname order by tag;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(48 rows)

select ctid, * from :tname order by tag, ts;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(48 rows)

-- order 0
select ctid, * from :tname order by tag desc;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
(48 rows)

select ctid, * from :tname order by tag desc, ts desc;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
(48 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
(48 rows)

-- order 0
select ctid, * from :tname order by ts;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(48 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(48 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
(48 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,3)  |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (2,7)  |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |        | text 42
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |        | text 46
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |        | text 1041
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |        | text 1043
 (2,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (2,4)  |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (2,6)  |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (2,8)  |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (3,2)  |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |      |    4.1 | text 41
 (3,4)  |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (1,4)  |  10 | Sat Jan 01 12:00:30 2000 |      |    4.3 | text 43
 (1,6)  |  11 | Sat Jan 01 12:00:10 2000 |      |    4.5 | text 45
 (3,6)  |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (1,8)  |  11 | Sat Jan 01 12:00:30 2000 |      |    4.7 | text 47
 (3,8)  |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (1,10) |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (3,10) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (1,12) |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (3,12) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (1,14) |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (3,14) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (3,16) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (1,16) |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
 (4,6)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,7)  |  11 | Sat Jan 01 12:00:20 2000 |      | 1004.6 | text 1046
 (4,8)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
(48 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            |  c1  | c2  |    c3     
-------+-----+--------------------------+------+-----+-----------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 |  400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |      | 4.1 | text 41
 (1,3) |  10 | Sat Jan 01 12:00:20 2000 |  420 |     | text 42
 (1,4) |  10 | Sat Jan 01 12:00:30 2000 |      | 4.3 | text 43
 (3,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |     | text 40
 (3,2) |  10 | Sat Jan 01 12:00:50 2000 |      | 4.1 | text 41
 (3,3) |  10 | Sat Jan 01 12:01:00 2000 |  420 |     | text 42
 (3,4) |  10 | Sat Jan 01 12:01:10 2000 |      | 4.3 | text 43
 (4,1) |  10 | Sat Jan 01 12:00:00 2000 | 1400 |     | text 1040
 (4,2) |  10 | Sat Jan 01 12:00:10 2000 | 1410 |     | text 1041
 (4,3) |  10 | Sat Jan 01 12:00:20 2000 | 1420 |     | text 1042
 (4,4) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |     | text 1043
(12 rows)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |        | text 40
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |        | text 44
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (2,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (2,5)  |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (4,5)  |  11 | Sat Jan 01 12:00:00 2000 |      | 1004.4 | text 1044
(8 rows)

select ctid, * from :tname where c1 >= 400;
  ctid  | tag |            ts            |  c1  | c2 |    c3     
--------+-----+--------------------------+------+----+-----------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 |  400 |    | text 40
 (1,3)  |  10 | Sat Jan 01 12:00:20 2000 |  420 |    | text 42
 (1,5)  |  11 | Sat Jan 01 12:00:00 2000 |  440 |    | text 44
 (1,7)  |  11 | Sat Jan 01 12:00:20 2000 |  460 |    | text 46
 (1,9)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |    | text 48
 (1,11) |  12 | Sat Jan 01 12:00:20 2000 |  500 |    | text 50
 (1,13) |  13 | Sat Jan 01 12:00:00 2000 |  520 |    | text 52
 (1,15) |  13 | Sat Jan 01 12:00:20 2000 |  540 |    | text 54
 (3,1)  |  10 | Sat Jan 01 12:00:40 2000 |  400 |    | text 40
 (3,3)  |  10 | Sat Jan 01 12:01:00 2000 |  420 |    | text 42
 (3,5)  |  11 | Sat Jan 01 12:00:40 2000 |  440 |    | text 44
 (3,7)  |  11 | Sat Jan 01 12:01:00 2000 |  460 |    | text 46
 (3,9)  |  12 | Sat Jan 01 12:00:40 2000 |  480 |    | text 48
 (3,11) |  12 | Sat Jan 01 12:01:00 2000 |  500 |    | text 50
 (3,13) |  13 | Sat Jan 01 12:00:40 2000 |  520 |    | text 52
 (3,15) |  13 | Sat Jan 01 12:01:00 2000 |  540 |    | text 54
 (4,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |    | text 1040
 (4,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    | text 1041
 (4,3)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |    | text 1042
 (4,4)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    | text 1043
(20 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
(2 rows)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
  ctid  |  c1  |   c2   |    c3     
--------+------+--------+-----------
 (1,1)  |  400 |        | text 40
 (1,2)  |      |    4.1 | text 41
 (1,3)  |  420 |        | text 42
 (1,4)  |      |    4.3 | text 43
 (1,5)  |  440 |        | text 44
 (1,6)  |      |    4.5 | text 45
 (1,7)  |  460 |        | text 46
 (1,8)  |      |    4.7 | text 47
 (1,9)  |  480 |        | text 48
 (1,10) |      |    4.9 | text 49
 (1,11) |  500 |        | text 50
 (1,12) |      |    5.1 | text 51
 (1,13) |  520 |        | text 52
 (1,14) |      |    5.3 | text 53
 (1,15) |  540 |        | text 54
 (1,16) |      |    5.5 | text 55
 (2,1)  |  320 |        | text 32
 (2,2)  |      |    3.3 | text 33
 (2,3)  |  340 |        | text 34
 (2,4)  |      |    3.5 | text 35
 (2,5)  |  360 |        | text 36
 (2,6)  |      |    3.7 | text 37
 (2,7)  |  380 |        | text 38
 (2,8)  |      |    3.9 | text 39
 (3,1)  |  400 |        | text 40
 (3,2)  |      |    4.1 | text 41
 (3,3)  |  420 |        | text 42
 (3,4)  |      |    4.3 | text 43
 (3,5)  |  440 |        | text 44
 (3,6)  |      |    4.5 | text 45
 (3,7)  |  460 |        | text 46
 (3,8)  |      |    4.7 | text 47
 (3,9)  |  480 |        | text 48
 (3,10) |      |    4.9 | text 49
 (3,11) |  500 |        | text 50
 (3,12) |      |    5.1 | text 51
 (3,13) |  520 |        | text 52
 (3,14) |      |    5.3 | text 53
 (3,15) |  540 |        | text 54
 (3,16) |      |    5.5 | text 55
 (4,1)  | 1400 |        | text 1040
 (4,2)  | 1410 |        | text 1041
 (4,3)  | 1420 |        | text 1042
 (4,4)  | 1430 |        | text 1043
 (4,5)  |      | 1004.4 | text 1044
 (4,6)  |      | 1004.5 | text 1045
 (4,7)  |      | 1004.6 | text 1046
 (4,8)  |      | 1004.7 | text 1047
(48 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |    12
  11 |    12
  12 |     8
  13 |     8
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |    12
  11 |    12
  12 |     8
  13 |     8
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |    12
  11 |    12
  12 |     8
  13 |     8
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     8
  11 |     4
  12 |     4
  13 |     4
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |    12
  11 |    12
  12 |     8
  13 |     8
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |    12
  11 |    12
  12 |     8
  13 |     8
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |    12
  11 |    12
  12 |     8
  13 |     8
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     8
  11 |     4
  12 |     4
  13 |     4
(6 rows)

-- vi: syntax=sql et :
-- vi: syntax=sql et :
\set tname test_mars_mergescan_group_tag
 \set tagtype int
 \set with 'with (group_col_ = "{tag}")'
 \i sql/mergescan.load.template
-- start_ignore
drop table if exists :tname;
-- end_ignore
create table :tname
     ( tag :tagtype
     , ts timestamp
     , c1 int
     , c2 float
     , c3 text
     )
 using mars
 :with
 distributed masteronly;
-- insert the initial data, no overlaps
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(40, 55) i;
-- rows in the same block are merged during INSERT
\i sql/mergescan.queries.template
select ctid, * from :tname;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

-- order 0
select ctid, * from :tname order by tag;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

select ctid, * from :tname order by tag, ts;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

-- order 0
select ctid, * from :tname order by tag desc;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
(4 rows)

select ctid, * from :tname order by tag desc, ts desc;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
(4 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

-- order 0
select ctid, * from :tname order by ts;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
(1 row)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
 ctid | tag | ts | c1 | c2 | c3 
------+-----+----+----+----+----
(0 rows)

select ctid, * from :tname where c1 >= 400;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
(1 row)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
 ctid  | c1  | c2  |   c3    
-------+-----+-----+---------
 (1,1) | 420 | 4.3 | text 43
 (2,1) | 460 | 4.7 | text 47
 (3,1) | 500 | 5.1 | text 51
 (4,1) | 540 | 5.5 | text 55
(4 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(4 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(4 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(4 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(4 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(4 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(4 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(4 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(4 rows)

-- vi: syntax=sql et :
-- insert the late data, no overlaps
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(32, 39) i;
-- blocks are not merged
\i sql/mergescan.queries.template
select ctid, * from :tname;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by tag;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(6 rows)

select ctid, * from :tname order by tag, ts;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by tag desc;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
(6 rows)

select ctid, * from :tname order by tag desc, ts desc;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
(6 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by ts;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(6 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
(1 row)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
 ctid | tag | ts | c1 | c2 | c3 
------+-----+----+----+----+----
(0 rows)

select ctid, * from :tname where c1 >= 400;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:00:30 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:00:30 2000 | 540 | 5.5 | text 55
(4 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 420 | 4.3 | text 43
(1 row)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
 ctid  | c1  | c2  |   c3    
-------+-----+-----+---------
 (5,1) | 340 | 3.5 | text 35
 (6,1) | 380 | 3.9 | text 39
 (1,1) | 420 | 4.3 | text 43
 (2,1) | 460 | 4.7 | text 47
 (3,1) | 500 | 5.1 | text 51
 (4,1) | 540 | 5.5 | text 55
(6 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

-- vi: syntax=sql et :
-- insert the late data, the blocks overlap, the rows do not
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10 + 40)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(40, 55) i;
-- blocks are merged on the group keys
\i sql/mergescan.queries.template
select ctid, * from :tname;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by tag;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(6 rows)

select ctid, * from :tname order by tag, ts;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by tag desc;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
(6 rows)

select ctid, * from :tname order by tag desc, ts desc;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
(6 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by ts;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 | 340 | 3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 | 380 | 3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(6 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
(1 row)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
 ctid | tag | ts | c1 | c2 | c3 
------+-----+----+----+----+----
(0 rows)

select ctid, * from :tname where c1 >= 400;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
 (2,1) |  11 | Sat Jan 01 12:01:10 2000 | 460 | 4.7 | text 47
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 | 500 | 5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 | 540 | 5.5 | text 55
(4 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:01:10 2000 | 420 | 4.3 | text 43
(1 row)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
 ctid  | c1  | c2  |   c3    
-------+-----+-----+---------
 (5,1) | 340 | 3.5 | text 35
 (6,1) | 380 | 3.9 | text 39
 (1,1) | 420 | 4.3 | text 43
 (2,1) | 460 | 4.7 | text 47
 (3,1) | 500 | 5.1 | text 51
 (4,1) | 540 | 5.5 | text 55
(6 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

-- vi: syntax=sql et :
-- insert the late data, both the blocks and rows overlap
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 8 < 4 then 1000 + i * 10 else null end
     , case when i % 8 > 3 then 1000 + i / 10. else null end
     , 'text ' || (1000 + i)
  from generate_series(40, 47) i;
-- blocks and orws are merged on the group keys
\i sql/mergescan.queries.template
select ctid, * from :tname;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by tag;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
(6 rows)

select ctid, * from :tname order by tag, ts;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by tag desc;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
(6 rows)

select ctid, * from :tname order by tag desc, ts desc;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
(6 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by ts;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
(6 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (5,1) |   8 | Sat Jan 01 12:00:30 2000 |  340 |    3.5 | text 35
 (6,1) |   9 | Sat Jan 01 12:00:30 2000 |  380 |    3.9 | text 39
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
(6 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            |  c1  | c2  |    c3     
-------+-----+--------------------------+------+-----+-----------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 | 4.3 | text 1043
(1 row)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
 ctid | tag | ts | c1 | c2 | c3 
------+-----+----+----+----+----
(0 rows)

select ctid, * from :tname where c1 >= 400;
 ctid  | tag |            ts            |  c1  |   c2   |    c3     
-------+-----+--------------------------+------+--------+-----------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1) |  11 | Sat Jan 01 12:00:30 2000 |  460 | 1004.7 | text 1047
 (3,1) |  12 | Sat Jan 01 12:01:10 2000 |  500 |    5.1 | text 51
 (4,1) |  13 | Sat Jan 01 12:01:10 2000 |  540 |    5.5 | text 55
(4 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            |  c1  | c2  |    c3     
-------+-----+--------------------------+------+-----+-----------
 (1,1) |  10 | Sat Jan 01 12:00:30 2000 | 1430 | 4.3 | text 1043
(1 row)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
 ctid  |  c1  |   c2   |    c3     
-------+------+--------+-----------
 (5,1) |  340 |    3.5 | text 35
 (6,1) |  380 |    3.9 | text 39
 (1,1) | 1430 |    4.3 | text 1043
 (2,1) |  460 | 1004.7 | text 1047
 (3,1) |  500 |    5.1 | text 51
 (4,1) |  540 |    5.5 | text 55
(6 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     1
   9 |     1
  10 |     1
  11 |     1
  12 |     1
  13 |     1
(6 rows)

-- vi: syntax=sql et :
-- vi: syntax=sql et :
\set tname test_mars_mergescan_group_tag_ts
 \set tagtype int
 \set with 'with (group_col_ = "{tag}", group_param_col_ = "{ts in 20s}")'
 \i sql/mergescan.load.template
-- start_ignore
drop table if exists :tname;
-- end_ignore
create table :tname
     ( tag :tagtype
     , ts timestamp
     , c1 int
     , c2 float
     , c3 text
     )
 using mars
 :with
 distributed masteronly;
-- insert the initial data, no overlaps
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(40, 55) i;
-- rows in the same block are merged during INSERT
\i sql/mergescan.queries.template
select ctid, * from :tname;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by tag;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

select ctid, * from :tname order by tag, ts;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by tag desc;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
(16 rows)

select ctid, * from :tname order by tag desc, ts desc;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
(16 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by ts;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
(16 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,2) |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,2) |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,2) |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,2) |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,2) |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,2) |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(16 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
(4 rows)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
 ctid  | tag |            ts            | c1  | c2 |   c3    
-------+-----+--------------------------+-----+----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
(4 rows)

select ctid, * from :tname where c1 >= 400;
 ctid  | tag |            ts            | c1  | c2 |   c3    
-------+-----+--------------------------+-----+----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |    | text 42
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |    | text 46
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |    | text 50
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |    | text 54
(8 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
(2 rows)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
 ctid  | c1  | c2  |   c3    
-------+-----+-----+---------
 (1,1) | 400 |     | text 40
 (1,2) |     | 4.1 | text 41
 (2,1) | 420 |     | text 42
 (2,2) |     | 4.3 | text 43
 (3,1) | 440 |     | text 44
 (3,2) |     | 4.5 | text 45
 (4,1) | 460 |     | text 46
 (4,2) |     | 4.7 | text 47
 (5,1) | 480 |     | text 48
 (5,2) |     | 4.9 | text 49
 (6,1) | 500 |     | text 50
 (6,2) |     | 5.1 | text 51
 (7,1) | 520 |     | text 52
 (7,2) |     | 5.3 | text 53
 (8,1) | 540 |     | text 54
 (8,2) |     | 5.5 | text 55
(16 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     2
  11 |     2
  12 |     2
  13 |     2
(4 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(4 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
  10 |     2
  11 |     2
  12 |     2
  13 |     2
(4 rows)

-- vi: syntax=sql et :
-- insert the late data, no overlaps
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(32, 39) i;
-- blocks are not merged
\i sql/mergescan.queries.template
select ctid, * from :tname;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

-- order 0
select ctid, * from :tname order by tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

select ctid, * from :tname order by tag, ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

-- order 0
select ctid, * from :tname order by tag desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
(24 rows)

select ctid, * from :tname order by tag desc, ts desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
(24 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

-- order 0
select ctid, * from :tname order by ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
(24 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
(24 rows)

select ctid, * from :tname where tag = '10';
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2) |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
(4 rows)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |    | text 32
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |    | text 36
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
(6 rows)

select ctid, * from :tname where c1 >= 400;
 ctid  | tag |            ts            | c1  | c2 |   c3    
-------+-----+--------------------------+-----+----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (2,1) |  10 | Sat Jan 01 12:00:20 2000 | 420 |    | text 42
 (3,1) |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (4,1) |  11 | Sat Jan 01 12:00:20 2000 | 460 |    | text 46
 (5,1) |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (6,1) |  12 | Sat Jan 01 12:00:20 2000 | 500 |    | text 50
 (7,1) |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
 (8,1) |  13 | Sat Jan 01 12:00:20 2000 | 540 |    | text 54
(8 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
(2 rows)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
  ctid  | c1  | c2  |   c3    
--------+-----+-----+---------
 (9,1)  | 320 |     | text 32
 (9,2)  |     | 3.3 | text 33
 (10,1) | 340 |     | text 34
 (10,2) |     | 3.5 | text 35
 (11,1) | 360 |     | text 36
 (11,2) |     | 3.7 | text 37
 (12,1) | 380 |     | text 38
 (12,2) |     | 3.9 | text 39
 (1,1)  | 400 |     | text 40
 (1,2)  |     | 4.1 | text 41
 (2,1)  | 420 |     | text 42
 (2,2)  |     | 4.3 | text 43
 (3,1)  | 440 |     | text 44
 (3,2)  |     | 4.5 | text 45
 (4,1)  | 460 |     | text 46
 (4,2)  |     | 4.7 | text 47
 (5,1)  | 480 |     | text 48
 (5,2)  |     | 4.9 | text 49
 (6,1)  | 500 |     | text 50
 (6,2)  |     | 5.1 | text 51
 (7,1)  | 520 |     | text 52
 (7,2)  |     | 5.3 | text 53
 (8,1)  | 540 |     | text 54
 (8,2)  |     | 5.5 | text 55
(24 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     2
  11 |     2
  12 |     2
  13 |     2
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     2
  11 |     2
  12 |     2
  13 |     2
(6 rows)

-- vi: syntax=sql et :
-- insert the late data, the blocks overlap, the rows do not
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10 + 40)::text::interval
     , case when i % 2 = 0 then i * 10 else null end
     , case when i % 2 > 0 then i / 10. else null end
     , 'text ' || i
  from generate_series(40, 55) i;
-- blocks are merged on the group keys
\i sql/mergescan.queries.template
select ctid, * from :tname;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

select ctid, * from :tname order by tag, ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by tag desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
(40 rows)

select ctid, * from :tname order by tag desc, ts desc;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
(40 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by ts;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
(40 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |     | text 32
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 | 340 |     | text 34
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |     | text 36
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 | 380 |     | text 38
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |     | text 44
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |     | text 44
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |     | text 46
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |     | text 46
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |     | text 48
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |     | text 48
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |     | text 50
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |     | text 50
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |     | text 52
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |     | text 52
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |     | text 54
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |     | text 54
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |     | 3.3 | text 33
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |     | 3.5 | text 35
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |     | 3.7 | text 37
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |     | 3.9 | text 39
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |     | 4.5 | text 45
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |     | 4.5 | text 45
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |     | 4.7 | text 47
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |     | 4.7 | text 47
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |     | 4.9 | text 49
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |     | 4.9 | text 49
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |     | 5.1 | text 51
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |     | 5.1 | text 51
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |     | 5.3 | text 53
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |     | 5.3 | text 53
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |     | 5.5 | text 55
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |     | 5.5 | text 55
(40 rows)

select ctid, * from :tname where tag = '10';
  ctid  | tag |            ts            | c1  | c2  |   c3    
--------+-----+--------------------------+-----+-----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |     | text 42
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 |     | 4.3 | text 43
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |     | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |     | 4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |     | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |     | 4.3 | text 43
(8 rows)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 | 320 |    | text 32
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 | 360 |    | text 36
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
(6 rows)

select ctid, * from :tname where c1 >= 400;
  ctid  | tag |            ts            | c1  | c2 |   c3    
--------+-----+--------------------------+-----+----+---------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 400 |    | text 40
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 420 |    | text 42
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 | 400 |    | text 40
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 | 420 |    | text 42
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 | 440 |    | text 44
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 | 460 |    | text 46
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 | 440 |    | text 44
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 | 460 |    | text 46
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 | 480 |    | text 48
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 | 500 |    | text 50
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 | 480 |    | text 48
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 | 500 |    | text 50
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 | 520 |    | text 52
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 | 540 |    | text 54
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 | 520 |    | text 52
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 | 540 |    | text 54
(16 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            | c1  | c2  |   c3    
-------+-----+--------------------------+-----+-----+---------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 400 |     | text 40
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 |     | 4.1 | text 41
(2 rows)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
  ctid  | c1  | c2  |   c3    
--------+-----+-----+---------
 (9,1)  | 320 |     | text 32
 (9,2)  |     | 3.3 | text 33
 (10,1) | 340 |     | text 34
 (10,2) |     | 3.5 | text 35
 (11,1) | 360 |     | text 36
 (11,2) |     | 3.7 | text 37
 (12,1) | 380 |     | text 38
 (12,2) |     | 3.9 | text 39
 (1,1)  | 400 |     | text 40
 (1,2)  |     | 4.1 | text 41
 (2,1)  | 420 |     | text 42
 (2,2)  |     | 4.3 | text 43
 (13,1) | 400 |     | text 40
 (13,2) |     | 4.1 | text 41
 (14,1) | 420 |     | text 42
 (14,2) |     | 4.3 | text 43
 (3,1)  | 440 |     | text 44
 (3,2)  |     | 4.5 | text 45
 (4,1)  | 460 |     | text 46
 (4,2)  |     | 4.7 | text 47
 (15,1) | 440 |     | text 44
 (15,2) |     | 4.5 | text 45
 (16,1) | 460 |     | text 46
 (16,2) |     | 4.7 | text 47
 (5,1)  | 480 |     | text 48
 (5,2)  |     | 4.9 | text 49
 (6,1)  | 500 |     | text 50
 (6,2)  |     | 5.1 | text 51
 (17,1) | 480 |     | text 48
 (17,2) |     | 4.9 | text 49
 (18,1) | 500 |     | text 50
 (18,2) |     | 5.1 | text 51
 (7,1)  | 520 |     | text 52
 (7,2)  |     | 5.3 | text 53
 (8,1)  | 540 |     | text 54
 (8,2)  |     | 5.5 | text 55
 (19,1) | 520 |     | text 52
 (19,2) |     | 5.3 | text 53
 (20,1) | 540 |     | text 54
 (20,2) |     | 5.5 | text 55
(40 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     4
  11 |     4
  12 |     4
  13 |     4
(6 rows)

-- vi: syntax=sql et :
-- insert the late data, both the blocks and rows overlap
insert into :tname
select (i / 4)::text:::tagtype
     , '2000-01-01 12:00:00'::timestamp + (i % 4 * 10)::text::interval
     , case when i % 8 < 4 then 1000 + i * 10 else null end
     , case when i % 8 > 3 then 1000 + i / 10. else null end
     , 'text ' || (1000 + i)
  from generate_series(40, 47) i;
-- blocks and orws are merged on the group keys
\i sql/mergescan.queries.template
select ctid, * from :tname;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by tag;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(40 rows)

select ctid, * from :tname order by tag, ts;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by tag desc;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
(40 rows)

select ctid, * from :tname order by tag desc, ts desc;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
(40 rows)

-- order 0
select ctid, * from :tname order by tag, time_bucket('20s', ts);
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by ts;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
(40 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts);
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by time_bucket('20s', ts), tag;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
(40 rows)

-- order 0
select ctid, * from :tname order by c1, c2;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (10,1) |   8 | Sat Jan 01 12:00:20 2000 |  340 |        | text 34
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (12,1) |   9 | Sat Jan 01 12:00:20 2000 |  380 |        | text 38
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (9,2)  |   8 | Sat Jan 01 12:00:10 2000 |      |    3.3 | text 33
 (10,2) |   8 | Sat Jan 01 12:00:30 2000 |      |    3.5 | text 35
 (11,2) |   9 | Sat Jan 01 12:00:10 2000 |      |    3.7 | text 37
 (12,2) |   9 | Sat Jan 01 12:00:30 2000 |      |    3.9 | text 39
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      |    4.1 | text 41
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      |    4.3 | text 43
 (15,2) |  11 | Sat Jan 01 12:00:50 2000 |      |    4.5 | text 45
 (16,2) |  11 | Sat Jan 01 12:01:10 2000 |      |    4.7 | text 47
 (17,2) |  12 | Sat Jan 01 12:00:50 2000 |      |    4.9 | text 49
 (5,2)  |  12 | Sat Jan 01 12:00:10 2000 |      |    4.9 | text 49
 (18,2) |  12 | Sat Jan 01 12:01:10 2000 |      |    5.1 | text 51
 (6,2)  |  12 | Sat Jan 01 12:00:30 2000 |      |    5.1 | text 51
 (7,2)  |  13 | Sat Jan 01 12:00:10 2000 |      |    5.3 | text 53
 (19,2) |  13 | Sat Jan 01 12:00:50 2000 |      |    5.3 | text 53
 (20,2) |  13 | Sat Jan 01 12:01:10 2000 |      |    5.5 | text 55
 (8,2)  |  13 | Sat Jan 01 12:00:30 2000 |      |    5.5 | text 55
 (3,2)  |  11 | Sat Jan 01 12:00:10 2000 |      | 1004.5 | text 1045
 (4,2)  |  11 | Sat Jan 01 12:00:30 2000 |      | 1004.7 | text 1047
(40 rows)

select ctid, * from :tname where tag = '10';
  ctid  | tag |            ts            |  c1  | c2  |    c3     
--------+-----+--------------------------+------+-----+-----------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |     | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 | 4.1 | text 1041
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |     | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 | 4.3 | text 1043
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |     | text 40
 (13,2) |  10 | Sat Jan 01 12:00:50 2000 |      | 4.1 | text 41
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |     | text 42
 (14,2) |  10 | Sat Jan 01 12:01:10 2000 |      | 4.3 | text 43
(8 rows)

select ctid, * from :tname where ts = '2000-01-01 12:00:00';
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (9,1)  |   8 | Sat Jan 01 12:00:00 2000 |  320 |        | text 32
 (11,1) |   9 | Sat Jan 01 12:00:00 2000 |  360 |        | text 36
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
(6 rows)

select ctid, * from :tname where c1 >= 400;
  ctid  | tag |            ts            |  c1  |   c2   |    c3     
--------+-----+--------------------------+------+--------+-----------
 (1,1)  |  10 | Sat Jan 01 12:00:00 2000 | 1400 |        | text 1040
 (1,2)  |  10 | Sat Jan 01 12:00:10 2000 | 1410 |    4.1 | text 1041
 (2,1)  |  10 | Sat Jan 01 12:00:20 2000 | 1420 |        | text 1042
 (2,2)  |  10 | Sat Jan 01 12:00:30 2000 | 1430 |    4.3 | text 1043
 (13,1) |  10 | Sat Jan 01 12:00:40 2000 |  400 |        | text 40
 (14,1) |  10 | Sat Jan 01 12:01:00 2000 |  420 |        | text 42
 (3,1)  |  11 | Sat Jan 01 12:00:00 2000 |  440 | 1004.4 | text 1044
 (4,1)  |  11 | Sat Jan 01 12:00:20 2000 |  460 | 1004.6 | text 1046
 (15,1) |  11 | Sat Jan 01 12:00:40 2000 |  440 |        | text 44
 (16,1) |  11 | Sat Jan 01 12:01:00 2000 |  460 |        | text 46
 (5,1)  |  12 | Sat Jan 01 12:00:00 2000 |  480 |        | text 48
 (6,1)  |  12 | Sat Jan 01 12:00:20 2000 |  500 |        | text 50
 (17,1) |  12 | Sat Jan 01 12:00:40 2000 |  480 |        | text 48
 (18,1) |  12 | Sat Jan 01 12:01:00 2000 |  500 |        | text 50
 (7,1)  |  13 | Sat Jan 01 12:00:00 2000 |  520 |        | text 52
 (8,1)  |  13 | Sat Jan 01 12:00:20 2000 |  540 |        | text 54
 (19,1) |  13 | Sat Jan 01 12:00:40 2000 |  520 |        | text 52
 (20,1) |  13 | Sat Jan 01 12:01:00 2000 |  540 |        | text 54
(18 rows)

select ctid, * from :tname where tag = '10' limit 2;
 ctid  | tag |            ts            |  c1  | c2  |    c3     
-------+-----+--------------------------+------+-----+-----------
 (1,1) |  10 | Sat Jan 01 12:00:00 2000 | 1400 |     | text 1040
 (1,2) |  10 | Sat Jan 01 12:00:10 2000 | 1410 | 4.1 | text 1041
(2 rows)

-- the merge should be triggered even if the groupkeys are not projected
select ctid, c1, c2, c3 from :tname;
  ctid  |  c1  |   c2   |    c3     
--------+------+--------+-----------
 (9,1)  |  320 |        | text 32
 (9,2)  |      |    3.3 | text 33
 (10,1) |  340 |        | text 34
 (10,2) |      |    3.5 | text 35
 (11,1) |  360 |        | text 36
 (11,2) |      |    3.7 | text 37
 (12,1) |  380 |        | text 38
 (12,2) |      |    3.9 | text 39
 (1,1)  | 1400 |        | text 1040
 (1,2)  | 1410 |    4.1 | text 1041
 (2,1)  | 1420 |        | text 1042
 (2,2)  | 1430 |    4.3 | text 1043
 (13,1) |  400 |        | text 40
 (13,2) |      |    4.1 | text 41
 (14,1) |  420 |        | text 42
 (14,2) |      |    4.3 | text 43
 (3,1)  |  440 | 1004.4 | text 1044
 (3,2)  |      | 1004.5 | text 1045
 (4,1)  |  460 | 1004.6 | text 1046
 (4,2)  |      | 1004.7 | text 1047
 (15,1) |  440 |        | text 44
 (15,2) |      |    4.5 | text 45
 (16,1) |  460 |        | text 46
 (16,2) |      |    4.7 | text 47
 (5,1)  |  480 |        | text 48
 (5,2)  |      |    4.9 | text 49
 (6,1)  |  500 |        | text 50
 (6,2)  |      |    5.1 | text 51
 (17,1) |  480 |        | text 48
 (17,2) |      |    4.9 | text 49
 (18,1) |  500 |        | text 50
 (18,2) |      |    5.1 | text 51
 (7,1)  |  520 |        | text 52
 (7,2)  |      |    5.3 | text 53
 (8,1)  |  540 |        | text 54
 (8,2)  |      |    5.5 | text 55
 (19,1) |  520 |        | text 52
 (19,2) |      |    5.3 | text 53
 (20,1) |  540 |        | text 54
 (20,2) |      |    5.5 | text 55
(40 rows)

-- aggscans behave the same with seqscans
set mars.enable_customscan to off;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     6
  11 |     4
  12 |     4
  13 |     4
(6 rows)

set mars.enable_customscan to on;
select tag, count(*) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(tag) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(ts) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     4
   9 |     4
  10 |     8
  11 |     8
  12 |     8
  13 |     8
(6 rows)

select tag, count(c1) from :tname group by tag order by tag;
 tag | count 
-----+-------
   8 |     2
   9 |     2
  10 |     6
  11 |     4
  12 |     4
  13 |     4
(6 rows)

-- vi: syntax=sql et :
-- vi: syntax=sql et :
-- bfv: filters on non-groupkeys should not affect the mergescan
\set tname test_mars_mergescan_bfv_t1
create table :tname (tag int, c1 int, c2 int)
 using mars with (group_col_ = '{tag}')
 distributed masteronly;
insert into :tname values (1, 10, 100);
insert into :tname values (1, 11, null);
select ctid, * from :tname;
 ctid  | tag | c1 | c2  
-------+-----+----+-----
 (1,1) |   1 | 11 | 100
(1 row)

-- should be empty
select ctid, * from :tname where c1 = 10;
 ctid | tag | c1 | c2 
------+-----+----+----
(0 rows)

-- should be the merged result
select ctid, * from :tname where c1 = 11;
 ctid  | tag | c1 | c2  
-------+-----+----+-----
 (1,1) |   1 | 11 | 100
(1 row)

-- vi: et :
